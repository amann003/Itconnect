<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title> IT</title>

<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
       
</head>
<style>
  *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Calibri ;
    }
  :root{
  --accent1:#4f46e5; --accent2:#06b6d4;
  --bg:#f8fafc;      --nav:#000000;   --nav-text:#f2f2f2;
}
.navbar{
    position: fixed;
    inset: 0 0 auto 0;
    height: 70px;
    background: var(--nav);
    display: flex;
    align-items: center;
    padding: 0 20px;
    z-index: 1001;
}
.navbar {
    color:#f2f2f2;
    font-weight: 700;
    font-size: 20px;
}

.brand{
  background-image: url("ITConnect-header.jpg");
  height: 50px;
  width: 200px;
  background-size: cover;  
}

.sidebar{
    position: fixed;
    top: 56px;
    left:0;
    height:calc(100vh - 56px);
    width: 150px;
    background: var(--nav);
    padding: 20px 12px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
    transition: width .3s;
    z-index: 1000;
}
.sidebar a{
  color:var(--nav-text);
  text-decoration:none;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:14px;
  padding:12px;
  border-radius:8px;
  white-space:nowrap;
  transition:background .2s;
}
.sidebar a i {
    font-size: 18px;
}
.sidebar a:hover{ 
    background: #44fc0c22;
}
@media(max-width:700px){
  .sidebar{
    transform:translateX(-100%);
    width:150px;           
  }
  .sidebar.show{transform:translateX(0);}   
}
.side-btn{
  background:none;
  border:none;
  width:100%;
  text-align:left;
  color:#04b1ef;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:14px;
  padding:12px;
  border-radius:8px;
  cursor:pointer;
  white-space:nowrap;
  transition:background .2s;
}
.side-btn.logout{
  margin-top: auto;
  background: #1f2937;
}
.side-btn.logout:hover{
  background: #b91616;
}
.side-btn:hover{
    background: #ffffff22;    
}
main{
  margin-top:56px;
  margin-left:150px;           
  padding:40px;
  /* background:linear-gradient(135deg,#3c4ea1,#4f2f6e); */
  min-height:calc(100vh - 56px);
  transition:margin-left .3s;
}
@media(max-width: 700px){
  main {
    margin-left: 0;
    padding: 20px;
  }
}
.view{
    display: none;
}
.view.active{
    display: block;
    color: #000000;
}
.view h2{
    margin-bottom: 24px;
    color: #110101;
}
.grid{
  /* max-width:1000px; */
  margin: auto;
 
  display:flex;
  flex-wrap: nowrap;
  justify-content: center;
  gap:28px;
  
}

#h2{
  margin-top: 50px;
}
#reviewCard{
    margin-top: 10px;
 
  display:flex;
  flex-wrap: nowrap;
  justify-content: center;
  gap:28px;
  
}

.card .count {
    font-size: 2.5rem;
    font-weight: bold;
    color: #4f46e5;
    margin: 10px 0;
}

.card:hover .count {
    color: #110101;
}

.card{
  background: #fff;
  width: 260px;
  border-radius: 16px;
  cursor: pointer;
  overflow:hidden;
   box-shadow:0 4px 18px rgba(0,0,0,.12);
   transition:transform .3s;
  }
.card:hover{
  transform: translateY(-4px);
}
.card:before{
  content: '';
  display: block;
  height: 4px;
  /* background:linear-gradient(90deg,var(--accent1),var(--accent2)); */
}
.card1{
  background-color: rgb(128, 128, 226);
}
.card2{
  background-color: rgb(124, 212, 124);
}
.card3{
  background-color: rgb(209, 185, 141);
}
.card4{
    background-color:rgb(85, 145, 168);
}
.card5{
  background-color: rgb(74, 131, 74);
}
.card6{
background-color: rgb(80, 143, 158);
}
.card7{
  background-color:rgb(154, 85, 168);
}
.card8{
 background-color: rgb(165, 128, 226);
}
.head{
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding:24px;
  color: #fff;
}
.title{
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 16px;
  font-weight: 600;
  color: #ffffff;
}
.title i{
  font-size:20px;
  color:var(--accent1);
}
.num{
  font-size: 46px;
  font-weight: 700;
  color:#ffffff;
  padding: 0 24px;
}
.label{
  font-size: 14px;
  color: #ffffff;
  padding:0 24px 24px; 
}
.popup{
  position:fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);
  background: #fff;
  width: 90%;
  max-width: 700px;
  max-height: 80vh;
  overflow-y: auto;
  border-radius: 12px;
  padding: 32px 28px;
  box-shadow: 0 20px 60px rgba(0,0,0,.25);
  z-index: 1050;
  display: none;
  animation: fade .25s ease;
}
@keyframes fade{
  from{
    opacity:0;
    transform:translate(-50%,-45%);
  }
  to{
    opacity:1;}
  }
.popup.active{
  display: block;
}
.close{
  position:absolute;
  top: 12px;
  right:16px;
  font-weight: bolder;
  font-size: 50px;
  color: #ec0707;
  cursor: pointer;
}
.close:hover{
  color: #f70606;
  transform: scaleX(-6px);
}

table{
  width:100%;
  border-collapse:collapse;
  background:var(--bg);
  margin-top:16px;
}
th,td{
  padding:12px 16px;
  border-bottom:1px solid #e5e7eb;
  font-size:14px;
  text-align:left;
}
thead th{
  background:#1e2133;
  color:#fff;
  font-size:12px;
  text-transform:uppercase;
  letter-spacing:.5px;
}
#addPasswordForm{
  max-width: 560px;
  margin: auto;
  background:rgba(18,24,40,.82);
  padding: 24px 16px 16px 16px;
  border-radius: 7px;
  box-shadow: 0 8px 30px #000a;
}
#addPasswordForm label{
  display: flex;
  flex-direction: column;
  font-size: 14px;
  color: #99e6fc;
  letter-spacing: 2px;
}
#addPasswordForm input, #addPasswordForm select{
  margin-top: 5px;
  border: 1px solid #262e42;
  background: rgba(28, 25,60, .85);
  color: #fff;
  font-size: 14px;
  padding:  7px 9px;
  border-radius: 5px;
  outline: none;
  transition: border-color .18s;
} 
#addPasswordForm input:focus, #addPasswordForm select:focus{
  border-color:#86d4e0;
}
#addPasswordForm button{
  margin-top: 14px;
  background:linear-gradient(90deg,#43e1fa 40%,#5b45fd 100%);
  color:#fff;
  font-weight:600;
  font-size:18px;
  border:none;
  border-radius:6px;
  padding:10px 0;
  letter-spacing:.3px;
  box-shadow:0 2px 18px #0334;
  cursor: pointer;
  transition: background .18s, box-shadow .15s;
}
#addPasswordForm button:hover {
  background: linear-gradient(90deg,#5b45fd 0, #43e1fa 100%);
  box-shadow: 0 6px 6px #2250c5;
}
#addAMCForm {
  max-width: 560px;
  margin: auto;
  background:rgba(18,24,40,.82); 
  padding: 25px 16px 16px 16px;
  border-radius: 10px;
  box-shadow: 0 8px 30px #000a;
}
#addAMCForm label{
  display: flex;
  flex-direction: column;
  font-size: 15px;
  color: #99e6fc;
  letter-spacing: 2px;
}
#addAMCForm input, #addAMCForm select{
  margin-top: 3px;
  border: 1px solid #262e42;
  background: rgb(28,35,60, .85);
  color: #fff;
  font-size: 14px;
  padding: 7px 9px;
  border-radius: 5px;
  outline: none;
  transition: border-color .18s;
}
#addAMCForm input:focus, #addAMCForm select:focus{
border-color: #43e1fa;
}
#addAMCForm button{
  margin-top: 14px;
  background: linear-gradient(90deg,#43e1fa 40%, #5b45fd 100%);
  color: #fff;
  font-weight: 600;
  font-size: 18px;
  border: none;
  border-radius: 5px;
  padding: 10px 0;
  letter-spacing: 1px;
  box-shadow: 0 2px 18px #0334;
  cursor: pointer;
  transition: background .18s, box-shadow .15s;
}
#addAMCForm button:hover{
  background:linear-gradient(90deg,#5b45fd 0,#43e1fa 100%);
  box-shadow:0 6px 18px #2250c5;
}

/* Sidebar full width on mobile */
@media(max-width: 700px){
  .sidebar {
    position: fixed;
    top: 56px; /* below navbar */
    left: 0;
    height: calc(100vh - 56px);
    width: 100%;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
   
  }
   .side-btn.logout{
    color: white;
    width: 110px;
    padding-left: 20px;
   
   }
  /* webbbb */
  .sidebar.show {
    transform: translateX(0);
      grid-template-columns: 1fr;
  }
}

#hamburger {
  display: none;
  cursor: pointer;
}
@media(max-width: 700px){
  #hamburger {
    display: block;
    font-size: 24px;
    color: white;
    margin-right: 16px;
  }
}
.form-grid {
  display: grid;
  grid-template-columns: 2fr ;
  gap: 16px;
}

@media(max-width: 600px){
  .form-grid {
    grid-template-columns: 1fr; /* stack inputs */
  }
}

/* AMC Modal Styles */
.amc-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2000;
    animation: fadeIn 0.3s ease-out;
    
}

.amc-modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    /* background:linear-gradient(135deg,#3c4ea1,#4f2f6e); */
    backdrop-filter: blur(10px);
    opacity: 0.7;
}

.amc-modal-container {
    position: relative;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(145deg, #ffffff, #f8faff);
    
    border-radius: 20px;
    box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.2);
    max-width: 95vw;
    max-height: 85vh;
    width: 1000px;
    overflow: hidden;
    animation: slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.amc-modal-header {
    /* background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); */
    color: white;
    padding: 24px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 3px solid #ffffff;
}

.amc-modal-header h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.amc-modal-close {
    background: rgb(228, 15, 15);
    border: 2px solid rgba(255,255,255,0.3);
    color: white;
    font-size: 40px;
    font-weight: bold;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    line-height: 1;
}

.amc-modal-close:hover {
    background: red;
    border-color: rgba(255,255,255,0.5);
    /* transform: rotate(90deg) scale(1.1); */
}

.amc-modal-body {
    padding: 30px;
    max-height: calc(85vh - 120px);
    overflow-y: auto;
   /* background:linear-gradient(135deg,#3c4ea1,#4f2f6e); */
}

/* Custom Table Styling for AMC Modal */
.amc-table {
    width: 100%;
    border-collapse: collapse;
    background: rgb(255, 255, 255);
    border-radius: 5px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    font-family: 'Segoe UI', Arial, sans-serif;
}

.amc-table thead {
    background: linear-gradient(135deg, #4c51bf, #6b73ff);
    color: white;
}

.amc-table thead th {
    padding: 18px 16px;
    font-weight: 600;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-align: left;
    border: none;
}

.amc-table tbody tr {
    transition: all 0.3s ease;
    border-bottom: 1px solid #e2e8f0;
}

.amc-table tbody tr:hover {
    background: linear-gradient(90deg, #ffffff, #f5f7f8);
    transform: scale(1.0);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.amc-table tbody tr:last-child {
    border-bottom: none;
}

.amc-table tbody td {
    padding: 16px;
    font-size: 14px;
    color: #4a5568;
    vertical-align: middle;
}

.amc-table tbody td:first-child {
    font-weight: 600;
    color: #2d3748;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translate(-50%, -30%) scale(0.8);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

/* Scrollbar styling for modal */
.amc-modal-body::-webkit-scrollbar {
    width: 8px;
}

.amc-modal-body::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.amc-modal-body::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 4px;
}

/* Mobile responsive */
@media (max-width: 768px) {
    .amc-modal-container {
        width: 95vw;
        margin: 20px;
    }
    
    .amc-modal-header {
        padding: 20px;
    }
    
    .amc-modal-header h2 {
        font-size: 20px;
    }
    
    .amc-modal-body {
        padding: 20px;
    }
    
    .amc-table {
        font-size: 12px;
    }
    
    .amc-table thead th,
    .amc-table tbody td {
        padding: 12px 8px;
    }
}

select option {
    display: block !important;
    visibility: visible !important;
}

#downloadAmcExcel {
    transition: all 0.3s ease;
}

#downloadAmcExcel:hover {
    background: #218838 !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

#downloadAmcExcel:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center; 
}

.user-info {
    color: white; 
    font-weight: bold; 
}


/* Pagination Styles */
#paginationControls {
    margin-top: 20px;
    padding: 20px 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.pagination-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
}

.page-btn {
    background: var(--nav);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 25px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.page-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 15px rgb(22, 24, 22)
}

.page-btn:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
    opacity: 0.6;
}

.page-info {
    background: rgba(255, 255, 255, 0.1);
    padding: 10px 20px;
    border-radius: 20px;
    color: rgb(0, 0, 0);
    font-weight: bold;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .pagination-wrapper {
        flex-direction: column;
        gap: 15px;
    }
    
    .page-btn {
        padding: 12px 24px;
        font-size: 16px;
    }
}

</style>
<body>

<header class="navbar">
    <div id="hamburger"><i class="fas fa-bars"></i></div>
    
    <div class="brand"></div>   

    <div class="user-info" id="userInfo">AMAN KUSHWAHA</div>
</header>

<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
  <button class="side-btn" data-view="view-dashboard"><i class="fas fa-home"></i><span>Dashboard</span></button>

  <button class="side-btn" data-view="view-amc"><i class="fas fa-chart-pie"></i><span>AMC</span></button>

  <button class="side-btn" data-view="view-password"><i class="fas fa-key"></i><span>Add Password</span></button>
  
  <button class="side-btn" data-view="view-add-amc"><i class="fas fa-plus-circle"></i><span>Add AMC</span></button>

  <button class="side-btn logout"><i class="fas fa-sign-out-alt"></i><span>Logout</span></button>
  
  
</nav>

  <main>
     <section id="view-dashboard" class="view active">
    <h2>AMC Expiring Details</h2>
    <div class="grid">
    <!-- 15 Days Card -->
    <div class="card card1" data-table="table1">
        <div class="head">
            <span class="title"><i class="fas fa-calendar"></i>15 Days</span>         
        </div>
        <div class="num">0</div>
        <div class="label">AMC Expiring Soon</div>
    </div>
    <!-- Monthly Card -->
    <div class="card card2" data-table="table2">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-alt"></i>Monthly</span>       
        </div>
        <div class="num">0</div>
        <div class="label">AMC This Month</div>
    </div>

    <!-- Quarterly Card -->
    <div class="card card3" data-table="table3">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-check"></i>Quarterly</span>
        </div>
        <div class="num">0</div>
        <div class="label">AMC This Quarter</div>
    </div>

   <!-- Expiry Card -->
 <div class="card card4" data-table="table4">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-check"></i>Expired</span>
        </div>
        <div class="num">0</div>
        <div class="label">AMC Expired</div>
    </div>

</div>


<h2 id="h2">AMC Review Details</h2>
<div id="reviewCard">

<div class="card card5" data-table="table4">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-check"></i>15 Dyas</span>
        </div>
        <div class="num">0</div>
        <div class="label">AMC Review</div>
    </div>

    <div class="card card6" data-table="table4">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-check"></i>Monthly</span>
        </div>
        <div class="num">0</div>
        <div class="label">AMC Review this Month</div>
    </div>

    <div class="card card7" data-table="table4">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-check"></i>Quarterly</span>
        </div>
        <div class="num">0</div>
        <div class="label">AMC Review this Quarter</div>
    </div>

    <div class="card card8" data-table="table4">
        <div class="head">
            <span class="title"><i class="fas fa-calendar-check"></i>Expired</span>
        </div>
        <div class="num">0</div>
        <div class="label">AMC Review Expired</div>
    </div>

</div>


</section>

    <!-- ADD PASSWORD VIEW -->
  <section id="view-password" class="view">
    <h2>Add Password</h2>

    <form id="addPasswordForm" >
      <div style=" display: flex; flex-direction: column; gap: 16px;">

        <div class="form-grid">

                 <label for="category">Category *</label>
        <select name="Category" id="category" required>
            <option value="">Loading...</option>
        </select>
        
        <!-- Sub-Category Field -->
       <label for="subCategory">Sub Category *</label>
        <select name="SubCategory" id="subCategory" required>
         <option value="">Loading...</option>
        </select>

          <label>
            <span>Link/URL</span>
            <input type="text" name="linkUrl" autocomplete="off">
          </label>

          <label>
            <span>IP</span>
            <input type="text" name="ip" autocomplete="off">
          </label>

          <label>
            <span>User Name</span>
            <input type="text" name="userName" autocomplete="off">
          </label>

          <label>
            <span>Password</span>
            <input type="password" name="password" autocomplete="off">
          </label>

          <label>
            <span>Register Email</span>
            <input type="email" name="registerEmail" autocomplete="off">
          </label>

          <label>
            <span>Registered Mobile</span>
            <input type="tel" name="registeredMobile" autocomplete="off">
          </label>

          <label>
            <span>Vendor</span>
            <input type="text" name="vendor" autocomplete="off">
          </label>

          <label>
            <span>Van Con Per</span>
           <input type="text" name="vanConPer" autocomplete="off">
          </label>

          <label>
            <span>Vendor Mobile</span>
         <input type="tel" name="vendorMobile" autocomplete="off">
          </label>

          <label>
            <span>Vendor Email</span>
            <input type="email" name="vendorEmail" autocomplete="off">
          </label>

           <label>
            <span>Service Details</span>
            <input type="text" name="serviceDetails" autocomplete="off">
          </label>

           <label>
            <span>Location</span>
            <input type="text" name="location" autocomplete="off">
          </label>       
            <button type="submit">Save</button>    
          </div>
      </div>
    </form>
  </section>


<!-- AMC VIEW -->
<section id="view-amc" class="view">
   
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>AMC</h2>
        <button id="downloadAmcExcel" style="
        background: #28a745;
        color: white;
        border:none;
        padding:  10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;">
        <i class="fas fa-download"></i>
            Download Excel
        </button>
    </div>

    <input type="text" id="amcSearch" placeholder="Search Item or Vendor" style="
          width:25%;
          padding:8px;
          font-size:16px;
          margin-bottom:20px;
          border-radius:5px;
          border:1px solid #746f6f;">
    <div id="amcList"></div>


  <!-- paging section  -->
<div id="paginationControls" style="display:none;">
        <div class="pagination-wrapper">
            <button id="prevPage" class="page-btn">‚Üê Previous</button>
            <div class="page-info">
                <span id="pageIndicator">Page 1 of 1</span>
            </div>
            <button id="nextPage" class="page-btn">Next ‚Üí</button>
        </div>
    </div>


    <!-- AMC Details Modal -->
<div id="amcModal" class="amc-modal">
    <div class="amc-modal-backdrop"></div>
    <div class="amc-modal-container">
        <div class="amc-modal-header">
            <h2>AMC Details</h2>
            <button class="amc-modal-close">&times;</button>
        </div>
        <div class="amc-modal-body" id="amcModalContent">
            <!-- Table content will be inserted here -->
        </div>
    </div>
</div>

</section>


<!-- UPDATED ADD AMC VIEW WITH NAME ATTRIBUTES -->
<section id="view-add-amc" class="view">
    <h2>Add AMC</h2>

    <form id="addAMCForm">
        <div style="display: flex;flex-direction: column;gap: 16px;">

            
             <label>
                  <span>Item</span>
                    <select name="item" id="itemDropdown" required>
                    <option value="">Loading products...</option>
                  </select>
             </label>


            <label>
                <span>Vendor</span>
                <input type="text" name="vendor" autocomplete="off" required>
            </label>

            <label>
                <span>Invoice no.</span>
                <input type="text" name="invoiceNo" autocomplete="off" required>
            </label>

            <label>
                <span>Purchase date</span>
                <input type="date" name="purchaseDate" autocomplete="off" required>
            </label>

            <label>
                <span>Start Date</span>
                <input type="date" name="startDate" autocomplete="off" required>
            </label>

            <label>
                <span>End Date</span>
                <input type="date" name="endDate" autocomplete="off" required>
            </label>

            <label>
                <span>Service Type</span>
                <input type="text" name="serviceType" autocomplete="off" required>
            </label>
            
            <label>
                <span>Service Description</span>
                <input type="text" name="serviceDescription" autocomplete="off" required>
            </label>
            
            <label>
                <span>Quantity</span>
                <input type="number" name="quantity" autocomplete="off" min="1" required>
            </label>
            
            <label>
                <span>Review Type</span>
                <select name="reviewType" required>
                    <option value="">Select Review Type</option>
                    <option value="Monthly">Monthly</option>
                    <option value="Quarterly">Quarterly</option>
                    <option value="Yearly">Yearly</option>
                </select>
            </label>

            <button type="submit" id="saveAmcBtn">SAVE</button>
        </div>
    </form>
</section>


</main>


<div id="popup" class="popup">
  <span class="close">&times;</span>
  <div id="content"></div>
</div>



<script>

  
//  Immediate authentication check
(function() {
    const userData = localStorage.getItem('userData');
    if (!userData) {
        alert('Please log in to access this page');
        window.location.href = 'Login.html';
        return;
    }
    
    try {
        const user = JSON.parse(userData);
        if (!user.username || !user.role || !user.key) {
            throw new Error('Invalid user data');
        }
    } catch (error) {
        localStorage.removeItem('userData');
        alert('Invalid session. Please log in again.');
        window.location.href = 'Login.html';
        return;
    }
})();


document.addEventListener('DOMContentLoaded', function() {
    checkAuthentication();
    displayUserInfo();
});

// Authentication check function
function checkAuthentication() {
    const userData = localStorage.getItem('userData');
    
    if (!userData) {
        // No user data found, redirect to login
        alert('Please log in to access this page');
        window.location.href = 'Login.html';
        return false;
    }
    
    try {
        const user = JSON.parse(userData);
        // Verify required fields exist
        if (!user.username || !user.role || !user.key) {
            throw new Error('Invalid user data');
        }
        return true;
    } catch (error) {
        
        localStorage.removeItem('userData')
        alert('Invalid session. Please log in again.');
        window.location.href = 'Login.html';
        return false;
    }
}

// Display user information
function displayUserInfo() {
    const userData = JSON.parse(localStorage.getItem('userData'));
    if (userData) {
        // Update the right side to show username and role
        const userInfoElement = document.getElementById('userInfo');
        userInfoElement.innerHTML = `${userData.username} (${userData.role})`;
        
        console.log('User logged in:', userData);
    }
}

const sidebar = document.getElementById('sidebar');
document.getElementById('hamburger').onclick = () =>
    sidebar.classList.toggle('show');

const views = document.querySelectorAll('.view');
document.querySelectorAll('.side-btn').forEach(btn => {
    btn.onclick = () => {
        views.forEach(v => v.classList.remove('active'));
        const targetView = document.getElementById(btn.dataset.view);
        if (targetView) {
            targetView.classList.add('active');
        }
        if (innerWidth <= 700) sidebar.classList.remove('show');
    };
});


// Popup functionality
const popup = document.getElementById('popup');
const body = document.getElementById('content');
document.querySelectorAll('.card').forEach(card => {
    card.onclick = () => {
        const tpl = document.getElementById(card.dataset.table).content.cloneNode(true);
        body.innerHTML = '';
        body.append(tpl);
        popup.classList.add('active');
    };
});

popup.querySelector('.close').onclick = () => popup.classList.remove('active');
popup.onclick = e => {
    if (e.target === popup) popup.classList.remove('active');
};



//  DASHBOARD AMC INTEGRATION 

async function loadDashboardAmcCounts() {
    try {
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (!userData) return;

        const response = await fetch('http://10.111.225.106/EssAnroidUAT/Api/PWDManager/GetProductlicenseinfo', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.key
            }
        });

        if (response.ok) {
            const result = await response.json();
            if (result.Status === 1 && Array.isArray(result.Data)) {
        //date format dd/mm/yy
                result.Data.forEach(item => {
            if (item.StartDate) item.StartDate = item.StartDate.split(' ')[0];
            if (item.ExpiryDate) item.ExpiryDate = item.ExpiryDate.split(' ')[0];
            if(item.DateofPurchase) item.DateofPurchase = item.DateofPurchase.split(' ')[0];
            
        });
                // Store AMC data globally for dashboard use
                window.dashboardAmcData = result.Data;
                updateDashboardCards(result.Data);
            }
        }
    } catch (error) {
        console.error('Dashboard AMC fetch error:', error);
    }
}

// Calculate expiry counts with EXCLUSIVE date ranges
function updateDashboardCards(amcData) {
    const today = new Date();
    const fifteenDays = new Date(today.getTime() + 15 * 24 * 60 * 60 * 1000);
    const thirtyDays = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
    const ninetyDays = new Date(today.getTime() + 90 * 24 * 60 * 60 * 1000);

    const expiryDays = new Date()

    let count15Days = 0;    // 0-15 days (exclusive)
    let countMonthly = 0;   // 16-30 days (exclusive)
    let countQuarterly = 0; // 31-90 days (exclusive)
    let countExpiry=0;

    amcData.forEach(item => {
        if (item.ExpiryDate && !item.ExpiryDate.includes('1/1/1900')) {
            const expiryDate = new Date(item.ExpiryDate);
            const daysLeft = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
            
            if (daysLeft >= 0 && daysLeft <= 15) {
                count15Days++;
            } 
            else if (daysLeft >= 16 && daysLeft <= 30) {
                countMonthly++;
            } 
            else if (daysLeft >= 31 && daysLeft <= 90) {
                 countQuarterly++;
            }
            else if(daysLeft<0){
                countExpiry++;
            }
        }
    });

    // Update card counts
    const card15Days = document.querySelector('[data-table="table1"] .num');
    const cardMonthly = document.querySelector('[data-table="table2"] .num'); 
    const cardQuarterly = document.querySelector('[data-table="table3"] .num');
    const cardExpiry = document.querySelector('[data-table="table4"] .num');

    if (card15Days) card15Days.textContent = count15Days;
    if (cardMonthly) cardMonthly.textContent = countMonthly;
    if (cardQuarterly) cardQuarterly.textContent = countQuarterly;
    if (cardExpiry) cardExpiry.textContent= countExpiry;
}


function getAmcDataByPeriod(period) {
    if (!window.dashboardAmcData) return [];
    
    const today = new Date();
    
    return window.dashboardAmcData.filter(item => {
        if (item.ExpiryDate && !item.ExpiryDate.includes('1/1/1900')) {
            const expiryDate = new Date(item.ExpiryDate);
            const daysLeft = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
            
            switch(period) {
                case '15days': return daysLeft >= 0 && daysLeft <= 15;
                    
                case 'monthly': return daysLeft >= 16 && daysLeft <= 30;
                    
                case 'quarterly': return daysLeft >= 31 && daysLeft <= 90;

                case 'expiry': return daysLeft <0;
                    
                default: return false;
            }
        }
        return false;
    });
}

// Enhanced popup functionality to show filtered AMC data
function showDashboardAmcTable(period, title) {

  window.currentDashboardPeriod = period;
    window.currentDashboardTitle = title;

    const filteredData = getAmcDataByPeriod(period);
    const popup = document.getElementById('popup');
    const content = document.getElementById('content');
  
    if (filteredData.length === 0) {
        content.innerHTML = `
            <div style="text-align:center; padding:40px;">
                <h3>${title}</h3>
                <p>No AMC items expiring in this period</p>
            </div>
        `;
        popup.classList.add('active');
        return;
    }

    const tableHTML = `
        <div style="max-width:100%; overflow-x:auto;">
            <h3 style="margin-bottom:20px; color:#333;">${title} - AMC Expiring</h3>
            <table style="
                width:100%;
                border-collapse:collapse;
                background:#fff;
                border-radius:8px;
                overflow:hidden;
                box-shadow:0 4px 12px rgba(0,0,0,0.1);
            ">
                <thead>
                    <tr style="background:#4f46e5; color:white;">
                        <th style="padding:12px 16px; text-align:left;">Product Name</th>
                        <th style="padding:12px 16px; text-align:left;">Vendor</th>
                        <th style="padding:12px 16px; text-align:left;">Start Date</th>
                        <th style="padding:12px 16px; text-align:left;">Expiry Date</th>
                        <th style="padding:12px 16px; text-align:left;">Days Left</th>
                        <th style="padding:12px 16px; text-align:left;">Action</th>
                    </tr>
                </thead>
                <tbody>
                   




${filteredData.map((item, index) => {
    const today = new Date();
    const expiryDate = new Date(item.ExpiryDate);
    const daysLeft = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
    
    return `
        <tr data-index="${index}" style="
            border-bottom:1px solid #eee;
            cursor: pointer;
            transition: background-color 0.3s ease;
        " 
        onmouseover="this.style.backgroundColor='#f8f9fa';" 
        onmouseout="this.style.backgroundColor='white';">
            <td style="padding:12px 16px;" onclick="showDashboardAmcDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})">${item.ProdcutName || '--'}</td>
            <td style="padding:12px 16px;" onclick="showDashboardAmcDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})">${item.Vendorname || '--'}</td>
            <td style="padding:12px 16px;" onclick="showDashboardAmcDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})">${item.StartDate || '--'}</td>
            <td style="padding:12px 16px;" onclick="showDashboardAmcDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})">${item.ExpiryDate || '--'}</td>
            <td style="padding:12px 16px; color:${daysLeft <= 7 ? 'red' : daysLeft <= 15 ? 'red' : 'green'}" onclick="showDashboardAmcDetails(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                ${daysLeft} days
            </td>
            <td style="padding:12px 16px; text-align:center;">
                <button onclick="openRenewForm(${JSON.stringify(item).replace(/"/g, '&quot;')}); event.stopPropagation();" style="
                    background: #28a745;
                    color: white;
                    border: none;
                    padding: 6px 12px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: bold;
                "> Renew</button>
            </td>
        </tr>
    `;
}).join('')}


                </tbody>
            </table>
        </div>
    `;

    content.innerHTML = tableHTML;
    popup.classList.add('active');

}


function openRenewForm(itemData) {
    console.log(' Opening renew form for:', itemData.ProdcutName);
   
    
    const content = document.getElementById('content');
    
    // Pre-fill current dates or set defaults
    const currentDate = new Date().toISOString().split('T')[0];
    const currentPurchaseDate = itemData.DateofPurchase || currentDate;
    
    // Calculate new expiry date (1 year from today as default)
    const oneYearLater = new Date();
    oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
    const defaultExpiryDate = oneYearLater.toISOString().split('T')[0];
    
    content.innerHTML = `
        <div style="max-width:600px; padding:10px; margin:0 auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                <h3 style="color:Black; margin:0;">Renew AMC Item</h3>
                <button onclick="goBackToDashboardTable()" style="
                    background:#6c757d; 
                    color:white; 
                    border:none; 
                    padding:8px 16px; 
                    border-radius:5px; 
                    cursor:pointer;
                ">‚Üê Back</button>
            </div>
            
     
        <div style="background:#f8f9fa; padding:20px; border-radius:8px; margin-bottom:25px; display:flex; justify-content:space-between;gap:2px">
            <p><strong>Product:</strong> ${itemData.ProdcutName || 'N/A'}</p>
            <p><strong>Vendor:</strong> ${itemData.Vendorname || 'N/A'}</p>
            <p><strong>Current Expiry:</strong> <span style="color:#dc3545;">${itemData.ExpiryDate || 'N/A'}</span></p>
        </div>
            
            <!-- Renew Form -->
            <form id="renewForm" style="background:#f8f9fa; padding:25px; border-radius:8px; border:2px  #e9ecef;">
                <h4 style="margin-top:0; color:black;">Renewal Information</h4>
                
                <div style=" margin-top:20px; margin-bottom:20px;">
                    <label style=" margin-bottom:8px; font-weight:bold; color:#555;">
                         New Purchase Date:
                    </label>
                    <input type="date" id="renewPurchaseDate" value="${currentPurchaseDate}" required style="
                        width:50%;
                        padding:10px;
                        border:1px solid #ddd;
                        border-radius:5px;
                        font-size:16px;
                    ">
                </div>
                
                <div style="margin-bottom:25px;">
                    <label style=" margin-bottom:8px; font-weight:bold; color:#555;">
                         New Expiry Date   :
                    </label>
                    <input type="date" id="renewExpiryDate" value="${defaultExpiryDate}" required style="
                        width:54%;
                        padding:10px;
                        border:1px solid #ddd;
                        border-radius:5px;
                        font-size:16px;
                    ">
                </div>
                
                <div style="text-align:center;">
                    <button type="button" onclick="submitRenewal(${JSON.stringify(itemData).replace(/"/g, '&quot;')})" style="
                        background:green;
                        color:white;
                        border:none;
                        padding:12px 30px;
                        border-radius:25px;
                        font-size:16px;
                        font-weight:bold;
                        cursor:pointer;
                        margin-right:15px;
                        transition:all 0.3s ease;
                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                         Renew AMC Item
                    </button>
                    
                    <button type="button" onclick="goBackToDashboardTable()" style="
                        background:#6c757d;
                        color:white;
                        border:none;
                        padding:12px 30px;
                        border-radius:25px;
                        font-size:16px;
                        cursor:pointer;
                    " onmouseover="this.style.transform='translateY(-1px)'" onmouseout="this.style.transform='translateY(0)'">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    `;
}

// Function to submit renewal to API
async function submitRenewal(itemData) {
    const purchaseDate = document.getElementById('renewPurchaseDate').value;
    const expiryDate = document.getElementById('renewExpiryDate').value;
    
    // Validate dates
    if (!purchaseDate || !expiryDate) {
        alert('Please fill in both dates');
        return;
    }
    
    if (new Date(expiryDate) <= new Date(purchaseDate)) {
        alert('Expiry date must be after purchase date');
        return;
    }
    
    console.log('üîÑ Submitting renewal:', {
        item: itemData.ProdcutName,
        purchaseDate,
        expiryDate
    });
    
    // Show loading state
    const submitBtn = document.querySelector('button[onclick*="submitRenewal"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Renewing...';
    submitBtn.disabled = true;
    
    try {
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (!userData) {
            throw new Error('User authentication required');
        }
        
        // Prepare renewal data - adjust fields based on your API requirements
        const renewalData = {
            // Add the fields your API expects - these are examples:
            ProductId: itemData.ProductId || itemData.ProdcutName,
            VendorId: itemData.VendorId || itemData.Vendorname,
            InvoiceNo: itemData.InvoiceNo,
            PurchaseDate: purchaseDate,
            ExpiryDate: expiryDate,
            RenewedDate: new Date().toISOString().split('T')[0]
            // Add other required fields here
        };
        
        // API call to renew item
        const response = await fetch('YOUR_RENEW_API_LINK_HERE', {
            method: 'POST', // or PUT, depending on your API
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.key
            },
            body: JSON.stringify(renewalData)
        });
        
        const result = await response.json();
        
        if (response.ok && result.Status === 1) {
            // Success!
            console.log('‚úÖ Renewal successful:', result);
          
            alert(`‚úÖ AMC item "${itemData.ProdcutName}" renewed successfully!\n\nNew expiry date: ${expiryDate}`);
            
            // Refresh the dashboard data
            await loadDashboardAmcCounts();
            
            // Go back to table with updated data
            if (window.currentDashboardPeriod && window.currentDashboardTitle) {
                showDashboardAmcTable(window.currentDashboardPeriod, window.currentDashboardTitle);
            }
            
        } else {
            // API returned error
            throw new Error(result.Message || 'Renewal failed');
        }
        
    } catch (error) {
        console.error('‚ùå Renewal error:', error);
        alert(`‚ùå Renewal failed: ${error.message}`);
        
        // Restore button
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
}









function showDashboardAmcDetails(itemData) {
    console.log('Showing AMC item details:', itemData);
    
    const content = document.getElementById('content');
    
    content.innerHTML = `
        <div style="max-width:100%; padding:20px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="color:black; margin:0;"> AMC Item Details</h3>
                <button onclick="goBackToDashboardTable()" style="
                    background:#6c757d; 
                    color:white; 
                    border:none; 
                    padding:8px 16px; 
                    border-radius:5px; 
                    cursor:pointer;
                ">‚Üê Back to List</button>
            </div>
            
            <table style="
                width:100%; 
                border-collapse:collapse; 
                background:#fff; 
                border-radius:8px; 
                overflow:hidden; 
                box-shadow:0 2px 8px rgba(0,0,0,0.1);
            ">
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px; font-weight:bold; background:#f8f9fa; width:40%;">Product Name</td>
                    <td style="padding:15px;">${itemData.ProdcutName || '--'}</td>
                </tr>
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px; font-weight:bold; background:#f8f9fa;">Vendor Name</td>
                    <td style="padding:15px;">${itemData.Vendorname || '--'}</td>
                </tr>
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px; font-weight:bold; background:#f8f9fa;">Invoice Number</td>
                    <td style="padding:15px;">${itemData.InvoiceNo || '--'}</td>
                </tr>
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px; font-weight:bold; background:#f8f9fa;"> Date of Purchase</td>
                    <td style="padding:15px;">${itemData.DateofPurchase || '--'}</td>
                </tr>
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:15px; font-weight:bold; background:#f8f9fa;"> Start Date</td>
                    <td style="padding:15px;">${itemData.StartDate || '--'}</td>
                </tr>
                <tr>
                    <td style="padding:15px; font-weight:bold; background:#f8f9fa;">Expiry Date</td>
                    <td style="padding:15px; font-weight:bold; color:#dc3545;">${itemData.ExpiryDate || '--'}</td>
                </tr>
            </table>
        </div>
    `;
}


function goBackToDashboardTable() {
  
    if (window.currentDashboardPeriod && window.currentDashboardTitle) {
        showDashboardAmcTable(window.currentDashboardPeriod, window.currentDashboardTitle);
    } else {
     
        document.getElementById('popup').classList.remove('active');
    }
}


document.addEventListener('DOMContentLoaded', function() {
    
    loadDashboardAmcCounts();

    document.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', () => {
            const tableId = card.dataset.table;
            
            
            if (tableId === 'table1') {
               
                showDashboardAmcTable('15days', '15 Days Expiry');
            } else if (tableId === 'table2') {
                // Monthly card  
                showDashboardAmcTable('monthly', 'Monthly Expiry');
            } else if (tableId === 'table3') {
                // Quarterly card
                showDashboardAmcTable('quarterly', 'Quarterly Expiry');
            }
            else if (tableId === 'table4') {
                // Expiry card
                showDashboardAmcTable('expiry', 'Expiry');
            } else {
           
                const tpl = document.getElementById(tableId);
                if (tpl) {
                    const content = document.getElementById('content');
                    content.innerHTML = '';
                    content.append(tpl.content.cloneNode(true));
                    document.getElementById('popup').classList.add('active');
                }
            }
        });
    });
    
    // Refresh AMC data every 5 minutes
    setInterval(loadDashboardAmcCounts, 5 * 60 * 1000);
});

document.addEventListener('DOMContentLoaded', function() {
    console.log('Setting up Add Password event listener...');
    
    const addPasswordBtn = document.querySelector('[data-view="view-password"]');
    
    if (addPasswordBtn) {
        console.log('Add Password button found!');
        
        addPasswordBtn.addEventListener('click', function() {
            console.log('Add Password clicked - loading categories!');
            
            setTimeout(() => {
                loadCategoriesAndSubCategories();
            }, 300);
        });
        
        console.log(' Event listener attached successfully');
    } else {
        console.error(' Add Password button not found');
    }
});


//  AMC 
let currentPage = 1;
const itemsPerPage = 5;
let filteredAmcData = [];

async function loadAmcRecords() {
    const userData = JSON.parse(localStorage.getItem('userData'));
    if (!userData) return;

    const amcList = document.getElementById('amcList');
    if (!amcList) return;
    
    amcList.innerHTML = '<div style="color:white;padding:20px;text-align:center;">Loading AMC records...</div>';

    try {
        const response = await fetch('http://10.111.225.106/EssAnroidUAT/Api/PWDManager/GetProductlicenseinfo', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.key
            }
        });

        const result = await response.json();
        
        if (response.ok && result.Status === 1 && Array.isArray(result.Data)) {
          
            result.Data.forEach(item => {
                if (item.StartDate) item.StartDate = item.StartDate.split(' ')[0];
                if (item.ExpiryDate) item.ExpiryDate = item.ExpiryDate.split(' ')[0];
                if (item.DateofPurchase) item.DateofPurchase = item.DateofPurchase.split(' ')[0];
            });

            window.lastAmcData = result.Data;
            renderAmcList(result.Data);
        } else {
            amcList.innerHTML = '<div style="color:white;padding:20px;text-align:center;">No AMC records found</div>';
            document.getElementById('paginationControls').style.display = 'none';
        }
    } catch (error) {
        amcList.innerHTML = `<div style="color:red;padding:20px;text-align:center;">Error: ${error.message}</div>`;
        document.getElementById('paginationControls').style.display = 'none';
    }
}

function renderAmcList(amcArray) {
    const amcList = document.getElementById('amcList');
    const searchValue = document.getElementById('amcSearch').value.trim().toLowerCase();
    
    // Store original data and apply search filter
    window.originalAmcData = amcArray;
    filteredAmcData = amcArray.filter(item => {
        const productName = (item.ProdcutName || '').toLowerCase();
        const vendorName = (item.Vendorname || '').toLowerCase();
        return productName.includes(searchValue) || vendorName.includes(searchValue);
    });
 
    currentPage = 1;

    renderCurrentPage();

    updatePaginationControls();
}

function renderCurrentPage() {
    const amcList = document.getElementById('amcList');
    
    if (!filteredAmcData || filteredAmcData.length === 0) {
        amcList.innerHTML = '<div style="color:white;padding:20px;text-align:center;">No records found</div>';
        document.getElementById('paginationControls').style.display = 'none';
        return;
    }

    document.getElementById('paginationControls').style.display = 'flex';

    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = Math.min(startIndex + itemsPerPage, filteredAmcData.length);

    const pageData = filteredAmcData.slice(startIndex, endIndex);

    amcList.innerHTML = pageData.map((item, index) => `
        <div class="amc-card" data-index="${startIndex + index}" style="
            background: #1e2133;
            color: white;
            margin-bottom: 16px;
            border-radius: 14px;
            box-shadow: 0 2px 10px #232a56cc;
            padding: 18px 16px;
            font-size: 15px;
            border: 1px solid #3cc0ff55;
            cursor: pointer;
            transition: all 0.3s ease;
        " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 8px 25px #8f99a3';" 
           onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 10px #8f99a3';">
            <div><b>Item:</b> ${item.ProdcutName || 'N/A'}</div>
            <div><b>Start Date:</b> ${item.StartDate || 'N/A'}</div>
            <div><b>End Date:</b> ${item.ExpiryDate || 'N/A'}</div>
            <div><b>Vendor Name:</b> ${item.Vendorname || 'N/A'}</div>
            <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">Click to view details</div>
        </div>
    `).join('');

    document.querySelectorAll('.amc-card').forEach(card => {
        card.addEventListener('click', () => {
            const index = parseInt(card.getAttribute('data-index'));
            showAmcDetailsModal(filteredAmcData[index - startIndex]);
        });
    });
}


function updatePaginationControls() {
    const totalPages = Math.ceil(filteredAmcData.length / itemsPerPage);
    const totalItems = filteredAmcData.length;

    document.getElementById('pageIndicator').textContent = 
        `Page ${currentPage} of ${totalPages} (${totalItems} items)`;
    
    document.getElementById('prevPage').disabled = currentPage === 1;
    document.getElementById('nextPage').disabled = currentPage === totalPages || totalPages === 0;
}

function goToPreviousPage() {
    if (currentPage > 1) {
        currentPage--;
        renderCurrentPage();
        updatePaginationControls();
        document.getElementById('downloadAmcExcel').scrollIntoView({ behavior: 'smooth' });
    }
}

function goToNextPage() {
    const totalPages = Math.ceil(filteredAmcData.length / itemsPerPage);
    if (currentPage < totalPages) {
        currentPage++;
        renderCurrentPage();
        updatePaginationControls();
        document.getElementById('downloadAmcExcel').scrollIntoView({ behavior: 'smooth' });
    }
}

function showAmcDetailsModal(itemData) {
    const amcModal = document.getElementById('amcModal');
    const amcModalContent = document.getElementById('amcModalContent');
    
    if (!amcModal || !amcModalContent) {
        alert(`Item: ${itemData.ProdcutName}\nVendor: ${itemData.Vendorname}\nStart: ${itemData.StartDate}\nEnd: ${itemData.ExpiryDate}`);
        return;
    }
    
    amcModalContent.innerHTML = `
        <table class="amc-table">
            <thead>
                <tr><th>Field</th><th>Value</th></tr>
            </thead>
            <tbody>           
                <tr><td>Product Name    </td><td>${itemData.ProdcutName    || '--'}</td></tr>
                <tr><td>Vendor Name     </td><td>${itemData.Vendorname     || '--'}</td></tr>
                <tr><td>Invoice Number  </td><td>${itemData.InvoiceNo      || '--'}</td></tr>
                <tr><td>Date of Purchase</td><td>${itemData.DateofPurchase || '--'}</td></tr>
                <tr><td>Start Date      </td><td>${itemData.StartDate      || '--'}</td></tr>
                <tr><td>Expiry Date     </td><td>${itemData.ExpiryDate     || '--'}</td></tr>                
            </tbody>
        </table>
    `;
    
    amcModal.style.display = 'block';
}
  
function downloadAmcExcel() {
    if (!window.lastAmcData || window.lastAmcData.length === 0) {
        alert('No AMC Data to download');
        return;
    }
    
    try {
        const dataForExcel = window.lastAmcData.map(item => ({
            'Product Name'    : item.ProdcutName    || '',
            'Start Date'      : item.StartDate      || '',
            'End Date'        : item.ExpiryDate     || '',
            'Vendor Name'     : item.Vendorname     || '',
            'Invoice Number'  : item.InvoiceNo      || '',
            'Date of Purchase': item.DateofPurchase || ''
        }));

        const worksheet = XLSX.utils.json_to_sheet(dataForExcel);

        const columnWidths = [
            { wch: 25 },
            { wch: 15 }, 
            { wch: 15 },
            { wch: 20 }, 
            { wch: 20 }, 
            { wch: 20 }
        ];
        worksheet['!cols'] = columnWidths;

        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, 'AMC Records');
        
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        const filename = `AMC_records_${dateStr}.xlsx`;

        XLSX.writeFile(workbook, filename);
       
    } catch (error) {
        
        alert('Error downloading Excel File, Try again');
    }
}


document.addEventListener('DOMContentLoaded', () => {

    const amcBtn = document.querySelector('[data-view="view-amc"]');
    if (amcBtn) {
        amcBtn.addEventListener('click', () => {
            loadAmcRecords();
            const amcSearch = document.getElementById('amcSearch');
            if (amcSearch) amcSearch.value = '';
        });
    }

    const amcSearch = document.getElementById('amcSearch');
    if (amcSearch) {
        amcSearch.addEventListener('input', () => {
            if (window.lastAmcData) renderAmcList(window.lastAmcData);
        });
    }

    const prevButton = document.getElementById('prevPage');
    const nextButton = document.getElementById('nextPage');
    
    if (prevButton) {
        prevButton.addEventListener('click', goToPreviousPage);
    }
    
    if (nextButton) {
        nextButton.addEventListener('click', goToNextPage);
    }

    const downloadBtn = document.getElementById('downloadAmcExcel');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', downloadAmcExcel);
    }

    const amcModal = document.getElementById('amcModal');
    const amcModalClose = document.querySelector('.amc-modal-close');
    const amcModalBackdrop = document.querySelector('.amc-modal-backdrop');
    
    if (amcModal && amcModalClose && amcModalBackdrop) {
        amcModalClose.addEventListener('click', () => amcModal.style.display = 'none');
        amcModalBackdrop.addEventListener('click', () => amcModal.style.display = 'none');
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && amcModal.style.display === 'block') {
                amcModal.style.display = 'none';
            }
        });
    }
});


//  Add Password form
document.getElementById('addPasswordForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const userData = JSON.parse(localStorage.getItem('userData'));
    if (!userData) {
        alert('Session Expired. Please Login Again.');
        window.location.href = 'Login.html';
        return;
    }
    
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Saving...';

    try {
        const formData = new FormData(this);

        const apiData = {
            Category: formData.get('Category'), // CategoryName from API
            SubCategory: formData.get('SubCategory'), // ProductName from API
            AccountManager: formData.get('vanConPer'),
            CreatedBy: userData.username,
            EmailId: formData.get('registerEmail'),
            IPAddress: formData.get('ip'),
            Location: formData.get('location'),
            Mobile: formData.get('registeredMobile'),
            Password: formData.get('password'),
            ServiceDetails: formData.get('serviceDetails'),
            ServiceProvider: formData.get('vendor'),
            ServiceProviderEmail: formData.get('vendorEmail'),
            ServiceProviderMobile: formData.get('vendorMobile'),
            Url: formData.get('linkUrl'),
            UserName: formData.get('userName')
        };

        console.log('Submitting password data:', apiData);

        const response = await fetch('http://10.111.225.106/EssAnroidUAT/Api/PWDManager/CreateCredential', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.key
            },
            body: JSON.stringify(apiData)
        });

        if (response.ok) {
            const result = await response.json();
            if (result.Status === 1) {
                alert('Password saved successfully!');
                this.reset();
                // Reload dropdowns after reset
                setTimeout(() => {
                    loadCategoriesAndSubCategories();
                }, 100);
            } else {
                alert('Error: ' + result.message);
            }
        } else {
            alert('Server error. Please try again.');
        }

    } catch (error) {
        console.error('Error:', error);
        alert('Network Error, Please Try again.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Save';
    }
});


// Function to load categories and sub-categories from your APIs
async function loadCategoriesAndSubCategories() {
    console.log(' Loading categories and sub-categories...');
    
    const userData = JSON.parse(localStorage.getItem('userData'));
    if (!userData) {
        console.error(' No userData found');
        return;
    }

    // Get your form elements (matching your HTML)
    const categorySelect = document.getElementById('category');
    const subCategorySelect = document.getElementById('subCategory');
    
    if (!categorySelect || !subCategorySelect) {
        console.error('Form elements not found');
        return;
    }

    // Show loading state
    categorySelect.innerHTML = '<option value="">Loading categories...</option>';
    categorySelect.disabled = true;
    subCategorySelect.innerHTML = '<option value="">Loading sub-categories...</option>';
    subCategorySelect.disabled = true;

    try {
        // Replace with your ACTUAL API URLs
        const [categoryResponse, subCategoryResponse] = await Promise.all([
            fetch('http://10.111.225.106/EssAnroidUAT/Api/PWDManager/GetCategoryList', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': userData.key
                }
            }),
            fetch('http://10.111.225.106/EssAnroidUAT/Api/PWDManager/GetProductList', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': userData.key
                }
            })
        ]);

        // Process Category Response
        if (categoryResponse.ok) {
            const categoryResult = await categoryResponse.json();
            
            if (categoryResult.Status === 1 && Array.isArray(categoryResult.Data)) {
                categorySelect.innerHTML = '<option value="">-- Select Category --</option>';
                categoryResult.Data.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.CategoryName;
                    option.textContent = category.CategoryName;
                    categorySelect.appendChild(option);
                });
                categorySelect.disabled = false;
                console.log(' Categories loaded:', categoryResult.Data.length);
            } else {
                categorySelect.innerHTML = '<option value="">No categories found</option>';
                categorySelect.disabled = false;
            }
        } else {
            categorySelect.innerHTML = '<option value="">Error loading categories</option>';
            categorySelect.disabled = false;
        }

        // Process Sub-Category Response
        if (subCategoryResponse.ok) {
            const subCategoryResult = await subCategoryResponse.json();
            
            if (subCategoryResult.Status === 1 && Array.isArray(subCategoryResult.Data)) {
                subCategorySelect.innerHTML = '<option value="">-- Select Sub Category --</option>';
                subCategoryResult.Data.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.ProductName; // ProductName mapped to SubCategory
                    option.textContent = product.ProductName;
                    subCategorySelect.appendChild(option);
                });
                subCategorySelect.disabled = false;
                console.log(' Sub-categories loaded:', subCategoryResult.Data.length);
            } else {
                subCategorySelect.innerHTML = '<option value="">No sub-categories found</option>';
                subCategorySelect.disabled = false;
            }
        } else {
            subCategorySelect.innerHTML = '<option value="">Error loading sub-categories</option>';
            subCategorySelect.disabled = false;
        }

    } catch (error) {
        console.error(' Error loading data:', error);
        categorySelect.innerHTML = '<option value="">Network error</option>';
        categorySelect.disabled = false;
        subCategorySelect.innerHTML = '<option value="">Network error</option>';
        subCategorySelect.disabled = false;
    }
}

document.querySelector('.logout').onclick = () => {
  
    localStorage.clear(); 
    sessionStorage.clear();
    
    alert('You have been logged out successfully');
    window.location.href = 'Login.html';
};

async function handleAddAMCSubmission(event) {
    event.preventDefault();
    
    console.log('üîÑ Submitting Add AMC form...');
    
    const form = document.getElementById('addAMCForm');
    const saveBtn = document.getElementById('saveAmcBtn');
    
    // Show loading state
    const originalBtnText = saveBtn.textContent;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    saveBtn.disabled = true;
    
    try {
        // Get user authentication
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (!userData) {
            throw new Error('User authentication required. Please login again.');
        }
        
        // Get form data
        const formData = new FormData(form);
        
        // Get selected product details
        const itemDropdown = document.getElementById('itemDropdown');
        const selectedProductId = formData.get('item');
        const selectedProductName = itemDropdown.options[itemDropdown.selectedIndex].text;
        
        console.log(' Selected Product:', {
            id: selectedProductId,
            name: selectedProductName
        });
     
        const purchaseDate = formData.get('purchaseDate');
        const startDate = formData.get('startDate');
        const endDate = formData.get('endDate');
        
        if (new Date(endDate) <= new Date(startDate)) {
            throw new Error('End date must be after start date');
        }
        
        const amcData = {
            ProductId:      parseInt(selectedProductId), 
            ProdcutName:    selectedProductName,       
            ServiceType:    formData.get('serviceType'),
            ServiceDesc:    formData.get('serviceDescription'),
            Vendorname:     formData.get('vendor'),
            InvoiceNo:      formData.get('invoiceNo'),
            DateofPurchase: formData.get('purchaseDate'),
            StartDate:      formData.get('startDate'),
            ExpiryDate:     formData.get('endDate'),
            UserName:       userData.username || userData.user || 'System',
            Quantity:       parseInt(formData.get('quantity')) || 1,
            ReviewType:     formData.get('reviewType')
        };
        
        console.log('üì§ Sending AMC data:', amcData);
        
      
        const response = await fetch('https://ess.bhagwati.co/essapps/Api/PWDManager/licenseinfo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.key
            },
            body: JSON.stringify(amcData)
        });
        
        const result = await response.json();
        
        if (response.ok && result.Status === 1) {
            // Success!
            showSuccessMessage(' AMC record added successfully!', result.message);
            form.reset();
            
            loadProductsForAmc();
         
            if (window.lastAmcData) {
                setTimeout(() => loadAmcRecords(), 1000);
            }
            if (typeof loadDashboardAmcCounts === 'function') {
                setTimeout(() => loadDashboardAmcCounts(), 1000);
            }
            
        } else {
            throw new Error(result.message || 'Failed to save AMC record');
        }
        
    } catch (error) {
        console.error(' Add AMC error:', error);
        showErrorMessage('Failed to add AMC record', error.message);
    } finally {
       
        saveBtn.innerHTML = originalBtnText;
        saveBtn.disabled = false;
    }
}

async function loadProductsForAmc() {
    const dropdown = document.getElementById('itemDropdown');
    
    if (!dropdown) {
        console.error(' Item dropdown not found');
        return;
    }
    
    try {
       
        dropdown.innerHTML = '<option value="">Loading products...</option>';
        dropdown.disabled = true;
        
        const userData = JSON.parse(localStorage.getItem('userData'));
        if (!userData) {
            throw new Error('User authentication required');
        }
        
        const response = await fetch('http://10.111.225.106/EssAnroidUAT/Api/PWDManager/GetProductList', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': userData.key
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log(' Products API response:', result);
        
        if (result.Status === 1 && Array.isArray(result.Data)) {
        
            dropdown.innerHTML = '<option value="">Select Product</option>';
            
            // Add each product as an option
            result.Data.forEach(product => {
                const option = document.createElement('option');
                option.value = product.ProductId;        // Use ProductId as value
                option.textContent = product.ProductName; // Use ProductName as display text
                dropdown.appendChild(option);
            });
        
            dropdown.disabled = false;
            console.log(` Loaded ${result.Data.length} products successfully`);
            
        } else {
            throw new Error('Invalid API response format');
        }
        
    } catch (error) {
        console.error('Error loading products:', error);
 
        dropdown.innerHTML = '<option value="">Error loading products</option>';
        dropdown.disabled = false;

        showErrorMessage('Failed to load products', error.message);
    }
}

//  LOAD PRODUCTS WHEN ADD AMC VIEW OPENS
function initializeAddAmcView() {
 
    loadProductsForAmc();
   
    const addAmcBtn = document.querySelector('[data-view="view-add-amc"]');
    if (addAmcBtn) {
        addAmcBtn.addEventListener('click', function() {
            
            setTimeout(() => {
                loadProductsForAmc();
            }, 200);
        });
    }
}

function showSuccessMessage(title, message) {
   
    if (typeof toastr !== 'undefined') {
        toastr.success(message, title);
    } else {
        alert(`${title}\n${message}`);
    }
}

function showErrorMessage(title, message) {
   
    if (typeof toastr !== 'undefined') {
        toastr.error(message, title);
    } else {
        alert(`${title}\n${message}`);
    }
}

// auto-fill dates 
function autoFillDates() {
    const purchaseDateInput = document.querySelector('input[name="purchaseDate"]');
    const startDateInput = document.querySelector('input[name="startDate"]');
    const endDateInput = document.querySelector('input[name="endDate"]');
    
    if (purchaseDateInput) {
        purchaseDateInput.addEventListener('change', function() {
            const purchaseDate = new Date(this.value);
            
            if (startDateInput && !startDateInput.value) {
                startDateInput.value = this.value;
            }
     
            if (endDateInput && !endDateInput.value) {
                const oneYearLater = new Date(purchaseDate);
                oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
                endDateInput.value = oneYearLater.toISOString().split('T')[0];
            }
        });
    }
}


document.addEventListener('DOMContentLoaded', function() {
    const addAMCForm = document.getElementById('addAMCForm');
    
    if (addAMCForm) {
        addAMCForm.addEventListener('submit', handleAddAMCSubmission);
        
        initializeAddAmcView();
      
        autoFillDates();

        const addAmcBtn = document.querySelector('[data-view="view-add-amc"]');
        if (addAmcBtn) {
            addAmcBtn.addEventListener('click', function() {
                setTimeout(() => {
                    if (addAMCForm) {
                        addAMCForm.reset();
                        
                    }
                }, 100);
            });
        }
        
        console.log('Add AMC form initialized successfully');
    } else {
        console.error('Add AMC form not found');
    }
});

document.addEventListener('DOMContentLoaded', addValidationStyling);

</script>
</body>
</html>
